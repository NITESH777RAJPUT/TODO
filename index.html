<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>To-Do App</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-light: linear-gradient(135deg, #6dd5fa, #ff758c);
      --text-primary: #1e272e;
      --card-bg: rgba(255, 255, 255, 0.15);
      --card-backdrop: blur(10px);
      --card-border: rgba(255, 255, 255, 0.2);
      --btn-add: #ff4757;
      --btn-edit: #00b894;
      --btn-delete: #ffa502;
      --btn-complete: #636e72;
      --accent-purple: #6c5ce7;
      --accent-orange: #d63031;
      --shadow-soft: 0 8px 30px rgba(0, 0, 0, 0.1);
      --shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.15);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      max-width: 1100px;
      margin: 0 auto;
      padding: 40px;
      background: var(--bg-light);
      min-height: 100vh;
      overflow-y: auto;
      color: var(--text-primary);
      position: relative;
      overflow: hidden;
    }

    @keyframes float {
      0% { transform: translateY(0) scale(1); opacity: 0.5; }
      50% { transform: translateY(-60px) scale(1.3); opacity: 0.7; }
      100% { transform: translateY(0) scale(1); opacity: 0.5; }
    }

    @keyframes drift {
      0% { transform: translateX(0) translateY(0); opacity: 0.4; }
      50% { transform: translateX(25px) translateY(-40px); opacity: 0.6; }
      100% { transform: translateX(0) translateY(0); opacity: 0.4; }
    }

    @keyframes pulseBubble {
      0% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.4); opacity: 0.8; }
      100% { transform: scale(1); opacity: 0.5; }
    }

    .bubble {
      position: absolute;
      border-radius: 50%;
      background: linear-gradient(45deg, #ff4757, #ff6b81);
      opacity: 0.5;
      z-index: 0;
      box-shadow: 0 0 15px rgba(255, 71, 87, 0.3);
    }

    .bubble:nth-child(1) { width: 30px; height: 30px; left: 10%; top: 20%; animation: float 6s infinite; }
    .bubble:nth-child(2) { width: 45px; height: 45px; left: 30%; top: 60%; animation: drift 8s infinite; }
    .bubble:nth-child(3) { width: 25px; height: 25px; left: 70%; top: 30%; animation: pulseBubble 5s infinite; }
    .bubble:nth-child(4) { width: 35px; height: 35px; left: 50%; top: 15%; animation: float 7s infinite; }
    .bubble:nth-child(5) { width: 50px; height: 50px; left: 20%; top: 75%; animation: drift 9s infinite; background: linear-gradient(45deg, var(--accent-purple), #a29bfe); }
    .bubble:nth-child(6) { width: 20px; height: 20px; left: 65%; top: 25%; animation: pulseBubble 6s infinite; background: linear-gradient(45deg, var(--btn-delete), #ffdd59); }
    .bubble:nth-child(7) { width: 60px; height: 60px; left: 85%; top: 65%; animation: float 10s infinite; background: linear-gradient(45deg, var(--btn-edit), #55efc4); }
    .bubble:nth-child(8) { width: 40px; height: 40px; left: 40%; top: 45%; animation: drift 7s infinite; background: linear-gradient(45deg, #6dd5fa, #ff758c); }

    .container {
      background: var(--card-bg);
      backdrop-filter: var(--card-backdrop);
      padding: 40px;
      border-radius: 25px;
      border: 1px solid var(--card-border);
      position: relative;
      z-index: 1;
      max-height: 92vh;
      overflow-y: auto;
      transition: transform 0.4s ease, box-shadow 0.4s ease;
      box-shadow: var(--shadow-soft);
    }

    .container:hover {
      transform: translateY(-8px);
      box-shadow: var(--shadow-hover);
    }

    @keyframes crazyPulse {
      0% { transform: scale(1) rotate(0deg); }
      20% { transform: scale(1.2) rotate(5deg); }
      40% { transform: scale(0.9) rotate(-5deg); }
      60% { transform: scale(1.15) rotate(3deg); }
      80% { transform: scale(0.95) rotate(-3deg); }
      100% { transform: scale(1) rotate(0deg); }
    }

    @keyframes hueRotate {
      0% { filter: hue-rotate(0deg); }
      100% { filter: hue-rotate(360deg); }
    }

    @keyframes shake {
      0% { transform: perspective(600px) translate3d(0, 0, 0) rotateY(0deg) rotateX(0deg); }
      10% { transform: perspective(600px) translate3d(-5px, 2px, 10px) rotateY(5deg) rotateX(-5deg); }
      20% { transform: perspective(600px) translate3d(5px, -2px, 10px) rotateY(-5deg) rotateX(5deg); }
      30% { transform: perspective(600px) translate3d(-3px, 3px, 10px) rotateY(3deg) rotateX(-3deg); }
      40% { transform: perspective(600px) translate3d(3px, -3px, 10px) rotateY(-3deg) rotateX(3deg); }
      50% { transform: perspective(600px) translate3d(0, 0, 0) rotateY(0deg) rotateX(0deg); }
      100% { transform: perspective(600px) translate3d(0, 0, 0) rotateY(0deg) rotateX(0deg); }
    }

    @keyframes particleBurst {
      0% { transform: translate3d(0, 0, 0) scale(1); opacity: 1; }
      100% { transform: translate3d(var(--x), var(--y), var(--z)) scale(0); opacity: 0; }
    }

    @keyframes rotate3D {
      0% { transform: perspective(600px) rotateY(-10deg) rotateX(10deg); }
      50% { transform: perspective(600px) rotateY(10deg) rotateX(-10deg); }
      100% { transform: perspective(600px) rotateY(-10deg) rotateX(10deg); }
    }

    .logo-container {
      text-align: center;
      margin-bottom: 30px;
      position: relative;
      animation: fadeIn 1.2s ease-out;
      perspective: 600px;
    }

    .logo-wrapper {
      position: relative;
      display: inline-block;
      transform-style: preserve-3d;
      animation: rotate3D 6s infinite ease-in-out;
    }

    .app-logo {
      max-width: 120px;
      height: auto;
      animation: crazyPulse 2s infinite, hueRotate 8s infinite linear;
      filter: drop-shadow(0 0 15px rgba(255, 71, 87, 0.7)) drop-shadow(0 5px 10px rgba(0, 0, 0, 0.3));
      transition: transform 0.3s ease;
      position: relative;
      z-index: 2;
      transform: translateZ(20px);
    }

    .app-logo:hover {
      animation: shake 0.5s ease;
      transform: translateZ(40px) scale(1.2);
    }

    .logo-shadow {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.2);
      filter: blur(10px);
      transform: translateZ(-10px);
      z-index: 1;
    }

    .logo-particles {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 150px;
      height: 150px;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 1;
      transform-style: preserve-3d;
    }

    .particle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: linear-gradient(45deg, #ff4757, #00b894);
      border-radius: 50%;
      animation: particleBurst 1.5s infinite ease-out;
      animation-delay: calc(var(--i) * 0.1s);
    }

    .section {
      margin-bottom: 35px;
      animation: slideIn 0.6s ease-out;
    }

    h2 {
      color: var(--accent-purple);
      border-bottom: 2px solid var(--btn-add);
      padding-bottom: 12px;
      margin-bottom: 25px;
      font-size: 1.8em;
      font-weight: 600;
      font-family: 'Roboto', sans-serif;
      letter-spacing: 0.8px;
      text-transform: capitalize;
    }

    .input-group {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 25px;
      align-items: center;
    }

    .sort-group {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: var(--shadow-soft);
    }

    th, td {
      padding: 18px;
      text-align: left;
      color: var(--text-primary);
    }

    th {
      background: linear-gradient(90deg, var(--btn-edit), #55efc4);
      color: white;
      font-weight: 600;
      font-family: 'Roboto', sans-serif;
      text-transform: uppercase;
      letter-spacing: 1.2px;
    }

    td {
      background: rgba(255, 255, 255, 0.95);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    tr {
      transition: all 0.3s ease;
    }

    tr:hover td {
      background: rgba(245, 246, 250, 0.8);
      transform: translateX(5px);
    }

    input[type="text"], input[type="date"], input[type="time"], input[type="file"], textarea, select {
      padding: 14px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      margin-right: 10px;
      box-sizing: border-box;
      background: rgba(255, 255, 255, 0.9);
      color: var(--text-primary);
      outline: none;
      transition: border-color 0.3s, box-shadow 0.3s, transform 0.3s;
      font-family: 'Inter', sans-serif;
      font-size: 1em;
      font-weight: 400;
    }

    input:focus, textarea:focus, select:focus {
      border-color: var(--accent-purple);
      box-shadow: 0 0 10px rgba(108, 92, 231, 0.3);
      transform: translateY(-2px);
    }

    textarea {
      height: 70px;
      resize: vertical;
      min-width: 280px;
    }

    button {
      padding: 14px 30px;
      margin-left: 10px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      color: white;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      font-size: 1em;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }

    button:hover::before {
      width: 300px;
      height: 300px;
    }

    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      animation: buttonPop 0.4s ease;
    }

    .add-btn {
      background: linear-gradient(45deg, var(--btn-add), #ff6b81);
    }
    .edit-btn {
      background: linear-gradient(45deg, var(--btn-edit), #55efc4);
    }
    .delete-btn {
      background: linear-gradient(45deg, var(--btn-delete), #ffdd59);
    }
    .complete-btn {
      background: linear-gradient(45deg, var(--btn-complete), #b2bec3);
    }
    .upload-btn {
      background: linear-gradient(45deg, var(--accent-purple), #a29bfe);
    }

    .completed td {
      text-decoration: line-through;
      color: #b2bec3;
      background: rgba(236, 240, 241, 0.8);
    }

    .timestamp {
      font-size: 0.9em;
      color: #636e72;
      font-weight: 300;
    }

    .priority-high {
      border-left: 5px solid var(--btn-add);
      background: rgba(255, 71, 87, 0.05);
    }
    .priority-medium {
      border-left: 5px solid var(--btn-delete);
      background: rgba(255, 165, 2, 0.05);
    }
    .priority-low {
      border-left: 5px solid var(--btn-edit);
      background: rgba(0, 184, 148, 0.05);
    }

    .due-date {
      color: var(--accent-orange);
      font-weight: 500;
    }

    .alert {
      background: linear-gradient(45deg, var(--btn-add), #ff6b81);
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      position: absolute;
      top: 15px;
      right: 15px;
      display: none;
      animation: pulse 1.8s infinite;
      font-size: 0.9em;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.06); }
      100% { transform: scale(1); }
    }

    .overdue .alert {
      display: block;
    }

    #searchInput {
      width: 100%;
      padding: 14px;
      margin-bottom: 20px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.9);
      color: var(--text-primary);
      font-size: 1em;
    }

    .progress-bar {
      width: 100%;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      margin-top: 20px;
      overflow: hidden;
    }

    .progress {
      height: 30px;
      background: linear-gradient(90deg, var(--btn-edit), #55efc4);
      border-radius: 10px;
      text-align: center;
      color: white;
      line-height: 30px;
      transition: width 0.6s ease-in-out;
      animation: slideIn 0.6s ease-out;
      font-family: 'Roboto', sans-serif;
      font-weight: 500;
    }

    .tags {
      color: #00cec9;
      font-style: italic;
      background: rgba(0, 206, 201, 0.1);
      padding: 5px 10px;
      border-radius: 8px;
      font-size: 0.9em;
    }

    .icon {
      margin-right: 10px;
      font-size: 1.3em;
      vertical-align: middle;
    }

    tr.task-enter {
      animation: fadeIn 0.6s ease-out;
    }

    tr.task-exit {
      animation: taskComplete 0.6s ease-out forwards;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: var(--card-bg);
      backdrop-filter: var(--card-backdrop);
      padding: 30px;
      border-radius: 20px;
      border: 1px solid var(--card-border);
      width: 90%;
      max-width: 600px;
      animation: modalFadeIn 0.4s ease-out;
      box-shadow: var(--shadow-hover);
    }

    .modal-content h3 {
      margin-top: 0;
      color: var(--accent-purple);
      font-size: 1.6em;
      font-family: 'Roboto', sans-serif;
      font-weight: 600;
    }

    .modal-content input[type="text"],
    .modal-content textarea {
      width: 100%;
      margin-bottom: 25px;
    }

    .modal-content textarea {
      height: 120px;
    }

    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 20px;
    }

    .save-btn {
      background: linear-gradient(45deg, var(--btn-edit), #55efc4);
    }

    .cancel-btn {
      background: linear-gradient(45deg, var(--btn-complete), #b2bec3);
    }

    @keyframes buttonPop {
      0% { transform: scale(1); }
      50% { transform: scale(1.18); }
      100% { transform: scale(1); }
    }

    @keyframes fadeIn {
      0% { opacity: 0; transform: scale(0.92); }
      100% { opacity: 1; transform: scale(1); }
    }

    @keyframes slideIn {
      0% { transform: translateX(-60px); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }

    @keyframes taskComplete {
      0% { transform: translateY(0); opacity: 1; }
      100% { transform: translateY(30px); opacity: 0; }
    }

    @keyframes modalFadeIn {
      0% { opacity: 0; transform: translateY(-30px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 768px) {
      body { padding: 20px; }
      .container { padding: 25px; }
      .input-group { flex-direction: column; }
      textarea, input, select { min-width: 100%; margin-right: 0; }
      button { margin-left: 0; width: 100%; padding: 14px; }
      .modal-content { width: 95%; padding: 20px; }
      h2 { font-size: 1.5em; }
      table { font-size: 0.9em; }
      th, td { padding: 12px; }
    }

    @media (max-width: 480px) {
      .app-logo { max-width: 80px; }
      .container { max-height: 95vh; }
      .section { margin-bottom: 25px; }
      .logo-particles { width: 100px; height: 100px; }
      .particle { width: 4px; height: 4px; }
    }
  </style>
</head>
<body>
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="bubble"></div>
  <div class="container">
    <div class="logo-container">
      <div class="logo-wrapper">
        <img src="https://iili.io/FzrIqQV.md.png" alt="To-Do App Logo" class="app-logo">
        <div class="logo-shadow"></div>
      </div>
      <div class="logo-particles">
        <div class="particle" style="--x: 20px; --y: 20px; --z: 10px; --i: 1;"></div>
        <div class="particle" style="--x: -30px; --y: 15px; --z: -5px; --i: 2;"></div>
        <div class="particle" style="--x: 25px; --y: -25px; --z: 8px; --i: 3;"></div>
        <div class="particle" style="--x: -20px; --y: -30px; --z: -10px; --i: 4;"></div>
        <div class="particle" style="--x: 30px; --y: 10px; --z: 5px; --i: 5;"></div>
        <div class="particle" style="--x: -15px; --y: 25px; --z: -8px; --i: 6;"></div>
        <div class="particle" style="--x: 10px; --y: -20px; --z: 10px; --i: 7;"></div>
        <div class="particle" style="--x: -25px; --y: 20px; --z: -5px; --i: 8;"></div>
      </div>
    </div>
    <div class="section">
      <h2><span class="icon">📋</span>Add Task</h2>
      <div class="input-group">
        <input type="text" id="taskInput" placeholder="Enter task title..." required>
        <textarea id="descriptionInput" placeholder="Enter task description..."></textarea>
        <select id="categorySelect" required>
          <option value="work">Work</option>
          <option value="personal">Personal</option>
          <option value="shopping">Shopping</option>
        </select>
        <select id="prioritySelect" required>
          <option value="low">Low</option>
          <option value="medium">Medium</option>
          <option value="high">High</option>
        </select>
        <input type="date" id="dueDateInput" required>
        <input type="time" id="dueTimeInput">
        <input type="text" id="tagsInput" placeholder="Tags (e.g., #urgent)">
        <select id="recurrenceSelect">
          <option value="none">No Recurrence</option>
          <option value="daily">Daily</option>
          <option value="weekly">Weekly</option>
          <option value="monthly">Monthly</option>
        </select>
        <select id="statusSelect" onchange="updateStatus()" required>
          <option value="pending">Pending</option>
          <option value="completed">Completed</option>
        </select>
        <button class="add-btn" onclick="addTask()"><span class="icon">➕</span>Add</button>
      </div>
    </div>

    <div class="section">
      <h2><span class="icon">📤</span>Upload Task File</h2>
      <div class="input-group">
        <input type="file" id="taskFileInput" accept=".json">
        <button class="upload-btn" onclick="uploadTaskFile()"><span class="icon">📂</span>Upload</button>
      </div>
    </div>

    <div class="section">
      <h2><span class="icon">🔍</span>Search Tasks</h2>
      <input type="text" id="searchInput" placeholder="Search tasks..." oninput="searchTasks()">
    </div>

    <div class="section">
      <h2><span class="icon">📊</span>Sort Tasks</h2>
      <div class="sort-group">
        <select id="sortSelect" onchange="sortTasks()">
          <option value="default">Default</option>
          <option value="priority">By Priority</option>
          <option value="dueDate">By Due Date</option>
          <option value="category">By Category</option>
        </select>
      </div>
    </div>

    <div class="section">
      <h2><span class="icon">📈</span>Progress</h2>
      <div class="progress-bar">
        <div id="progress" class="progress">0%</div>
      </div>
    </div>

    <div class="section">
      <h2><span class="icon">📋</span>Pending Tasks</h2>
      <table id="pendingTasks"></table>
    </div>

    <div class="section">
      <h2><span class="icon">✅</span>Completed Tasks</h2>
      <table id="completedTasks"></table>
    </div>
  </div>

  <div id="editModal" class="modal">
    <div class="modal-content">
      <h3><span class="icon">✏️</span>Edit Task</h3>
      <input type="text" id="editTitleInput" placeholder="Task title..." required>
      <textarea id="editDescriptionInput" placeholder="Task description..."></textarea>
      <div class="modal-buttons">
        <button class="save-btn" onclick="saveEditedTask()"><span class="icon">💾</span>Save</button>
        <button class="cancel-btn" onclick="closeEditModal()"><span class="icon">❌</span>Cancel</button>
      </div>
    </div>
  </div>

  <script>
    let pendingTasks = JSON.parse(localStorage.getItem('pendingTasks')) || [];
    let completedTasks = JSON.parse(localStorage.getItem('completedTasks')) || [];
    let currentEditList = null;
    let currentEditIndex = null;

    function addTask() {
      const taskInput = document.getElementById('taskInput');
      const descriptionInput = document.getElementById('descriptionInput');
      const taskText = taskInput.value.trim();
      const description = descriptionInput.value.trim();
      const category = document.getElementById('categorySelect').value;
      const priority = document.getElementById('prioritySelect').value;
      const dueDate = document.getElementById('dueDateInput').value;
      const dueTime = document.getElementById('dueTimeInput').value;
      const tagsInput = document.getElementById('tagsInput').value.trim();
      const recurrence = document.getElementById('recurrenceSelect').value;
      const status = document.getElementById('statusSelect').value;
      if (taskText && dueDate && category && priority && status) {
        const timestamp = new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });
        const task = { text: taskText, description: description, timestamp: timestamp, category, priority, dueDate, dueTime, tags: tagsInput, recurrence };
        if (status === 'pending') {
          pendingTasks.push(task);
        } else {
          completedTasks.push(task);
        }
        saveTasks();
        taskInput.value = '';
        descriptionInput.value = '';
        document.getElementById('dueDateInput').value = '';
        document.getElementById('dueTimeInput').value = '';
        document.getElementById('tagsInput').value = '';
        document.getElementById('recurrenceSelect').value = 'none';
        renderTasks();
        checkDueDates();
        showReminder(task);
        updateProgress();
      } else {
        alert('Please fill in all required fields.');
      }
    }

    function uploadTaskFile() {
      const fileInput = document.getElementById('taskFileInput');
      const file = fileInput.files[0];
      if (file) {
        if (file.type === 'application/json') {
          const reader = new FileReader();
          reader.onload = function(e) {
            try {
              const uploadedTasks = JSON.parse(e.target.result);
              if (Array.isArray(uploadedTasks)) {
                uploadedTasks.forEach(task => {
                  if (task.text && task.dueDate && task.category && task.priority && (task.status === 'pending' || task.status === 'completed')) {
                    task.timestamp = task.timestamp || new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });
                    task.description = task.description || '';
                    task.dueTime = task.dueTime || '';
                    task.tags = task.tags || '';
                    task.recurrence = task.recurrence || 'none';
                    if (task.status === 'pending') {
                      pendingTasks.push(task);
                    } else {
                      completedTasks.push(task);
                    }
                  } else {
                    alert('Invalid task format in file. Ensure each task has text, dueDate, category, priority, and status.');
                    return;
                  }
                });
                saveTasks();
                renderTasks();
                checkDueDates();
                updateProgress();
                fileInput.value = '';
                alert('Tasks uploaded successfully!');
              } else {
                alert('File must contain an array of tasks.');
              }
            } catch (error) {
              alert('Error parsing JSON file. Please ensure it is valid JSON.');
            }
          };
          reader.readAsText(file);
        } else {
          alert('Please upload a JSON file.');
        }
      } else {
        alert('No file selected.');
      }
    }

    function toggleTask(index) {
      const taskRow = document.querySelector(`#pendingTasks tr:nth-child(${index + 2})`);
      if (taskRow) {
        taskRow.classList.add('task-exit');
        setTimeout(() => {
          const task = pendingTasks.splice(index, 1)[0];
          task.timestamp = new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });
          completedTasks.push(task);
          saveTasks();
          renderTasks();
          updateProgress();
        }, 600);
      }
    }

    function editTask(list, index) {
      currentEditList = list;
      currentEditIndex = index;
      const task = list === 'pending' ? pendingTasks[index] : completedTasks[index];
      document.getElementById('editTitleInput').value = task.text;
      document.getElementById('editDescriptionInput').value = task.description || '';
      document.getElementById('editModal').style.display = 'flex';
    }

    function saveEditedTask() {
      const newText = document.getElementById('editTitleInput').value.trim();
      const newDesc = document.getElementById('editDescriptionInput').value.trim();
      if (newText) {
        if (currentEditList === 'pending') {
          pendingTasks[currentEditIndex].text = newText;
          pendingTasks[currentEditIndex].description = newDesc || '';
        } else {
          completedTasks[currentEditIndex].text = newText;
          completedTasks[currentEditIndex].description = newDesc || '';
        }
        saveTasks();
        renderTasks();
        closeEditModal();
      } else {
        alert('Task title cannot be empty.');
      }
    }

    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
      currentEditList = null;
      currentEditIndex = null;
    }

    function deleteTask(list, index) {
      const tableId = list === 'pending' ? 'pendingTasks' : 'completedTasks';
      const taskRow = document.querySelector(`#${tableId} tr:nth-child(${index + 2})`);
      if (taskRow) {
        taskRow.classList.add('task-exit');
        setTimeout(() => {
          if (list === 'pending') {
            pendingTasks.splice(index, 1);
          } else {
            completedTasks.splice(index, 1);
          }
          saveTasks();
          renderTasks();
          updateProgress();
        }, 600);
      }
    }

    function checkDueDates() {
      const now = new Date();
      pendingTasks.forEach(task => {
        if (task.dueDate && task.dueTime) {
          const [hours, minutes] = task.dueTime.split(':');
          const due = new Date(task.dueDate);
          due.setHours(hours, minutes);
          if (due < now) {
            task.overdue = true;
          } else {
            task.overdue = false;
          }
          if (task.recurrence !== 'none' && due < now) {
            const newDue = new Date(due);
            if (task.recurrence === 'daily') newDue.setDate(due.getDate() + 1);
            else if (task.recurrence === 'weekly') newDue.setDate(due.getDate() + 7);
            else if (task.recurrence === 'monthly') newDue.setMonth(due.getMonth() + 1);
            task.dueDate = newDue.toISOString().split('T')[0];
            task.dueTime = task.dueTime;
            task.overdue = false;
          }
        }
      });
      saveTasks();
      renderTasks();
    }

    function searchTasks() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const filteredPending = pendingTasks.filter(task => task.text.toLowerCase().includes(searchTerm) || (task.description && task.description.toLowerCase().includes(searchTerm)) || (task.tags && task.tags.toLowerCase().includes(searchTerm)));
      const filteredCompleted = completedTasks.filter(task => task.text.toLowerCase().includes(searchTerm) || (task.description && task.description.toLowerCase().includes(searchTerm)) || (task.tags && task.tags.toLowerCase().includes(searchTerm)));
      renderFilteredTasks(filteredPending, filteredCompleted);
    }

    function sortTasks() {
      const sortBy = document.getElementById('sortSelect').value;
      if (sortBy === 'priority') {
        pendingTasks.sort((a, b) => {
          const priorityOrder = { high: 1, medium: 2, low: 3 };
          return priorityOrder[a.priority] - priorityOrder[b.priority];
        });
      } else if (sortBy === 'dueDate') {
        pendingTasks.sort((a, b) => {
          const dateA = a.dueDate ? new Date(a.dueDate) : new Date(0);
          const dateB = b.dueDate ? new Date(b.dueDate) : new Date(0);
          return dateA - dateB;
        });
      } else if (sortBy === 'category') {
        pendingTasks.sort((a, b) => a.category.localeCompare(b.category));
      }
      renderTasks();
    }

    function renderFilteredTasks(pending, completed) {
      document.getElementById('pendingTasks').innerHTML = `
        <tr>
          <th><span class="icon">✅</span></th>
          <th>Title</th>
          <th>Description</th>
          <th>Category</th>
          <th>Priority</th>
          <th>Due Date & Time</th>
          <th>Timestamp</th>
          <th>Tags</th>
          <th>Recurrence</th>
          <th>Actions</th>
        </tr>
        ${pending.map((task, index) => `
          <tr class="priority-${task.priority} ${task.overdue ? 'overdue' : ''} task-enter">
            <td><input type="checkbox" onchange="toggleTask(${pendingTasks.indexOf(task)})" ${task.overdue ? 'disabled' : ''}></td>
            <td>${task.text}</td>
            <td>${task.description || '-'}</td>
            <td>${task.category}</td>
            <td>${task.priority}</td>
            <td>${task.dueDate ? `${task.dueDate} ${task.dueTime || ''}` : '-'}</td>
            <td class="timestamp">(${task.timestamp})</td>
            <td class="tags">${task.tags || '-'}</td>
            <td>${task.recurrence}</td>
            <td>
              <button class="edit-btn" onclick="editTask('pending', ${pendingTasks.indexOf(task)})"><span class="icon">✏️</span>Edit</button>
              <button class="delete-btn" onclick="deleteTask('pending', ${pendingTasks.indexOf(task)})"><span class="icon">🗑️</span>Delete</button>
            </td>
          </tr>
        `).join('')}
      `;
      document.getElementById('completedTasks').innerHTML = `
        <tr>
          <th>Title</th>
          <th>Description</th>
          <th>Category</th>
          <th>Priority</th>
          <th>Due Date & Time</th>
          <th>Timestamp</th>
          <th>Tags</th>
          <th>Recurrence</th>
          <th>Actions</th>
        </tr>
        ${completed.map((task, index) => `
          <tr class="completed priority-${task.priority} task-enter">
            <td>${task.text}</td>
            <td>${task.description || '-'}</td>
            <td>${task.category}</td>
            <td>${task.priority}</td>
            <td>${task.dueDate ? `${task.dueDate} ${task.dueTime || ''}` : '-'}</td>
            <td class="timestamp">(${task.timestamp})</td>
            <td class="tags">${task.tags || '-'}</td>
            <td>${task.recurrence}</td>
            <td>
              <button class="edit-btn" onclick="editTask('completed', ${index})"><span class="icon">✏️</span>Edit</button>
              <button class="delete-btn" onclick="deleteTask('completed', ${index})"><span class="icon">🗑️</span>Delete</button>
            </td>
          </tr>
        `).join('')}
      `;
    }

    function saveTasks() {
      localStorage.setItem('pendingTasks', JSON.stringify(pendingTasks));
      localStorage.setItem('completedTasks', JSON.stringify(completedTasks));
    }

    function updateProgress() {
      const totalTasks = pendingTasks.length + completedTasks.length;
      const completed = completedTasks.length;
      const percent = totalTasks === 0 ? 0 : Math.round((completed / totalTasks) * 100);
      const progress = document.getElementById('progress');
      progress.style.width = percent + '%';
      progress.textContent = percent + '%';
    }

    function renderTasks() {
      renderFilteredTasks(pendingTasks, completedTasks);
    }

    renderTasks();
    updateProgress();
    checkDueDates();

    function showReminder(task) {
      if (task.overdue) {
        alert(`Task "${task.text}" is overdue!`);
      }
    }
  </script>
</body>
</html>
